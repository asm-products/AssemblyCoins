<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">


</head>

<body>
<br><br><br>
<div class="row">
  <div class="col-md-4 col-md-offset-4">
    <h2>Form New Assembly Coins</h2>
  <div class="well">
    <form name="input" action="" onsubmit="return makeaddress(this); " method="get">
  Coin Name: <input type="text" name="coinname"><br><br>
  Amount to be Issued: <input type="text" name="issuedamount"><br><br>
  Coin Destination: <input type="text" name="destination"><br><br>
  Additional Message: <input type="text" name="message"><br><br>
  <input type="submit" value="Submit">
  </form>
</div>
</div>
</div>
<br><br><br>

<div id="addressplace">
</div>

<br><br><br><br>


</body>

<script src="bitcoinjs.min.js">
</script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>



<script>


function shownewaddress(publicaddress, privatekey, amounttosend, colorname, coloramount, destination){

var addresscontainer=document.createElement('div');
var addresscolumn=document.createElement('div');
addresscolumn.className="col-md-4 col-md-offset-4";

var addresswell=document.createElement('div');
addresswell.className="well";
var privatewell=document.createElement('div');
privatewell.className="well";

var header=document.createElement('h4');
header.innerHTML="Send "+amounttosend+" bitcoins to: <br><br>"+publicaddress+"<br><small> to send "+coloramount+" "+colorname+" coins to "+destination+"</small><br><br>";
var header2=document.createElement('h4');
header2.innerHTML="The Private Key for this address is <br>"+privatekey;
addresswell.appendChild(header);

privatewell.appendChild(header2);

addresscolumn.appendChild(addresswell);
addresscontainer.appendChild(addresscolumn);

var addressplace=document.getElementById("addressplace");
addressplace.innerHTML = "";
addressplace.appendChild(addresscontainer);

}


function makeaddress(theForm){

  var key = Bitcoin.ECKey.makeRandom()

  var public_address=key.pub.getAddress().toString();
  var private_key=key.toWIF();

  var coinname=theForm.coinname.value;
  var issuedamount=theForm.issuedamount.value;
  var destination=theForm.destination.value;
  var message=theForm.message.value;

url='http://bitwrangle.herokuapp.com'+'/addresses/givenew'
//url='http://bitwrangle.herokuapp.com/blocks/count'
outgoing_data={
  public: public_address,
  private: private_key,
  coin_name: coinname,
  color_amount: issuedamount,
  dest_address: destination,
  description: message
}

var amount_to_send;

$.post(url,
  outgoing_data,
  function(data,status){
      //alert("Data: " + data + "\nStatus: " + status);
      amount_to_send = data;
      shownewaddress(public_address, private_key, data, coinname, issuedamount, destination);
      console.log(data);
      console.log(typeof data);
    });



  //alert(public_address);

  return false;
};


</script>



</html>
