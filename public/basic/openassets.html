<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">


</head>

<body>
<br><br><br>
<div class="row">
  <div class="col-md-4 col-md-offset-4">
    <h2>Open Assets Transactions</h2>
  </div>
</div>
<br><br><br>

<div class="row">
  <div class="col-md-10 col-md-offset-1">
    <div class="well">
      <table class="table" id="txstable">

      </table>
    </div>
  </div>
</div>

<p id="test"></p>

</body>

<script src="bitcoinjs.min.js">
</script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="btctools.js"></script>



<script>



function add_tx(block, txhash, sourceaddress, destination, colornam, coloramt, spent, row_n, showlink){
  var txtable= document.getElementById('txstable');
  var row=txtable.insertRow(row_n);
  var blockdata=row.insertCell(0);
  var txhashdata=row.insertCell(1);
  var source_address=row.insertCell(2);
  var destination_address=row.insertCell(3);
  var colorname=row.insertCell(4);
  var coloramount=row.insertCell(5);

  if(showlink){
  blockdata.innerHTML="<a href=http://blockchain.info/block-index/"+block+"?format=json>"+block+"</a>";
  txhashdata.innerHTML="<a href=https://blockchain.info/tx/"+txhash+">"+txhash+"</a>";
  source_address.innerHTML="<a href=https://blockchain.info/address/"+sourceaddress+">"+sourceaddress+"</a>";
  destination_address.innerHTML="<a href=https://blockchain.info/address/"+destination+">"+destination+"</a>";
  colorname.innerHTML=colornam;
  coloramount.innerHTML=coloramt;
  //spentstatus.innerHTML=spent;
}
else{

blockdata.innerHTML=block;
txhashdata.innerHTML=txhash;
source_address.innerHTML=sourceaddress;
destination_address.innerHTML=destination;
colorname.innerHTML=colornam;
coloramount.innerHTML=coloramt;
//spentstatus.innerHTML=spent;
}


  }

function make_table(blockrange){
  add_tx("Block","Transaction Hash", "Sources", "Destination", "Color Address", "Color Amount",  0, false);

  $.get("http://bitwrangle.herokuapp.com/blocks/count",

  function(data,status){

    currentblock=data;
    document.getElementById('test').innerHTML="Last Block "+currentblock.toString();

    for(i=currentblock;i>currentblock-blockrange;i=i-1)
      {
        txs=getoatxs(i,
        function(txdata){

              txlength=txdata['data'].length;

              for (i=0; i<txlength; i++)
                {
                  var block = txdata['data'][i]['block'];
                  var txhash=txdata['data'][i]['hashid'];
                  var source_address=txdata['data'][i]['source_address'];
                  var destination=txdata['data'][i]['destination_address'];
                  var coloraddress=txdata['data'][i]['color_address'];
                  var coloramt=txdata['data'][i]['color_amount'];
                  var spentstatus=txdata['data'][i]['spent'];

                  console.log(block);
                  add_tx(block, txhash, source_address, destination, coloraddress, coloramt, spentstatus,i+1, true);
                }

        });
      }


  }
  );


}


make_table(100);



</script>



</html>
